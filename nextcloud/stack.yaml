services:

  nextcloud:
    container_name: nextcloud
    image: nextcloud:latest
    restart: unless-stopped
    ports:
      - '8083:8083'
    networks:
      netlab01:
        ipv4_address: ${NEXTCLOUD_HOST}
    volumes:
      - nextclouddata:/var/www/html
      - ${PWD}/apps:/var/www/html/custom_apps
      - ${PWD}/config:/var/www/html/config
      - ${PWD}/themes:/var/www/html/themes
    environment:
      - POSTGRES_DB=nextcloud
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=${POSTGRES_PWD}
      - POSTGRES_HOST=postgres
      - NEXTCLOUD_TRUSTED_DOMAINS=${LAB_DOMAIN} ${CI_LAB_DOMAIN}
      - APACHE_DISABLE_REWRITE_IP=1
      - TRUSTED_PROXIES=${LAB_DOMAIN} ${CI_LAB_DOMAIN}

volumes:
  nextclouddata:
    name: nextclouddata
    driver: local
