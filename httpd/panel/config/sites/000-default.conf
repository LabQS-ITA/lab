<VirtualHost *:80>
  
    ServerName ${LAB_DOMAIN}

    Protocols http/1.1 h2

    Header always set Strict-Transport-Security "max-age=63072000"

    ProxyPreserveHost On

    AllowEncodedSlashes NoDecode

    ErrorLog logs/error.log
    CustomLog logs/access.log combined

    ErrorDocument 404 /404.html
    ErrorDocument 503 /503.html

    <Directory /usr/local/apache2/htdocs>
        Options Indexes FollowSymLinks
        Allowoverride all
        Require all granted
    </Directory>

    ProxyPass /rabbitmq/api http://rabbitmng:15672/api
    ProxyPass /rabbitmq http://rabbitmng:15672
    ProxyPassReverse /rabbitmq http://rabbitmng:15672

    ProxyPass /redmine http://redmine:3000/redmine
    ProxyPassReverse /redmine http://redmine:3000/redmine

    ProxyPass /grafana http://grafana:3001
    ProxyPassReverse /grafana http://grafana:3001

    ProxyPass /prometheus http://prometheus:9090/prometheus
    ProxyPassReverse /prometheus http://prometheus:9090/prometheus

    ProxyPass /nebula http://nebula:8001
    ProxyPassReverse /nebula http://nebula:8001

    ProxyPass /apigw http://hasura:8080
    ProxyPassReverse /apigw http://hasura:8080
    
    RewriteRule /jupyter/(.*) ws://jupyter:8000/jupyter/$1 [P,L]
    RewriteRule /jupyter/(.*) http://jupyter:8000/jupyter/$1 [P,L]

    ProxyPass /jupyter http://jupyter:8000/jupyter/
    ProxyPassReverse /jupyter http://jupyter:8000/jupyter/

    ProxyPass /labelstudio http://labelstudio:8000
    ProxyPassReverse /labelstudio http://labelstudio:8000

</VirtualHost>
