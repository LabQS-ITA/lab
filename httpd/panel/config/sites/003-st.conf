<VirtualHost _default_:80>

    ServerName ${ST_LAB_DOMAIN}

    RedirectMatch permanent /(.*)$ https://${ST_LAB_DOMAIN}/

</VirtualHost>

<VirtualHost _default_:443>

    ServerName ${ST_LAB_DOMAIN}

    SSLEngine on

    SSLCertificateFile "certificates/live/${ST_LAB_DOMAIN}/fullchain.pem"
    SSLCertificateKeyFile "certificates/live/${ST_LAB_DOMAIN}/privkey.pem"

    Protocols h2 http/1.1

    Header always set Strict-Transport-Security "max-age=63072000"

    RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
    RequestHeader set "X-Forwarded-SSL" expr=%{HTTPS}

    RewriteEngine On
    RewriteCond %{HTTP:UPGRADE} ^WebSocket$ [NC]
    RewriteCond %{HTTP:CONNECTION} ^Upgrade$ [NC,OR]
    
    RewriteRule .* ws://minio01:9000/$1 [P,L]

    # ProxyPass /ws/ ws://minio01:9000/ws/
    # ProxyPassReverse /ws/ ws://minio01:9000/ws/

    ProxyPass / http://minio01:9001/
    ProxyPassReverse / http://minio01:9001/

    # ProxyRequests On
    # ProxyPreserveHost On
    # ProxyVia On

    # AllowEncodedSlashes NoDecode

</VirtualHost>
