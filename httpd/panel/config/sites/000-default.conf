<VirtualHost _default_:80>
  
    ServerName @LAB_DOMAIN

    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]

</VirtualHost>

<VirtualHost _default_:443>
  
    ServerName @LAB_DOMAIN

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    ProxyPreserveHost On
    ProxyRequests Off

    ErrorDocument 404 /404.html
    ErrorDocument 503 /503.html

    AllowEncodedSlashes NoDecode

    ErrorLog logs/error.log
    CustomLog logs/access.log combined

    <Directory /usr/local/apache2/htdocs>
        Allowoverride all
    </Directory>

    ProxyPass /adminer http://adminer:80
    ProxyPassReverse /adminer http://adminer:80

    ProxyPass /git http://gitea:3000
    ProxyPassReverse /git http://gitea:3000

    ProxyPass /commander http://commander:8081/commander
    ProxyPassReverse /commander http://commander:8081/commander

    ProxyPass /locust http://localhost:8089/
    ProxyPassReverse /locust http://localhost:8089/

    ProxyPass /nextcloud http://localhost:8083/
    ProxyPassReverse /nextcloud http://localhost:8083/

    SSLEngine on
    SSLCertificateFile "certificates/live/@LAB_DOMAIN/fullchain.pem"
    SSLCertificateKeyFile "certificates/live/@LAB_DOMAIN/privkey.pem"

</VirtualHost>
