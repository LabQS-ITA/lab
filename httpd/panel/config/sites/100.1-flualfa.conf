<VirtualHost _default_:80>
  
    ServerName ${LAB_DOMAIN}

    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/\.well\-known/acme\-challenge/
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]

</VirtualHost>

<VirtualHost _default_:443>
  
    ServerName ${LAB_DOMAIN}

    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>

    ProxyPreserveHost On
    ProxyRequests Off

    ErrorDocument 404 /404.html
    ErrorDocument 503 /503.html

    AllowEncodedSlashes NoDecode

    ErrorLog logs/error.log
    CustomLog logs/access.log combined

    <Location '/flualfa'>

        ProxyPass           /    http://172.1.100.1:10001
        ProxyPassReverse    /    http://172.1.100.1:10001

    </Location>

    SSLEngine on
    SSLCertificateFile "certificates/live/${LAB_DOMAIN}/fullchain.pem"
    SSLCertificateKeyFile "certificates/live/${LAB_DOMAIN}/privkey.pem"

</VirtualHost>
