<VirtualHost _default_:80>

    ServerName ${IA_LAB_DOMAIN}

    RedirectMatch permanent /(.*)$ https://${IA_LAB_DOMAIN}/

</VirtualHost>

<VirtualHost _default_:443>

    ServerName ${IA_LAB_DOMAIN}

    RewriteRule /jupyter/(.*) ws://jupyter:8000/jupyter/$1 [P,L]
    RewriteRule /jupyter/(.*) http://jupyter:8000/jupyter/$1 [P,L]

    ProxyPass /jupyter http://jupyter:8000/jupyter/
    ProxyPassReverse /jupyter http://jupyter:8000/jupyter/

    SSLEngine on

    SSLCertificateFile "certificates/live/${IA_LAB_DOMAIN}/fullchain.pem"
    SSLCertificateKeyFile "certificates/live/${IA_LAB_DOMAIN}/privkey.pem"

    Protocols h2 http/1.1

    Header always set Strict-Transport-Security "max-age=63072000"

</VirtualHost>
