<VirtualHost _default_:80>

    ServerName ${ST_LAB_DOMAIN}

    RedirectMatch permanent /(.*)$ https://${ST_LAB_DOMAIN}/

</VirtualHost>

<VirtualHost _default_:443>

    ServerName ${ST_LAB_DOMAIN}

    # RewriteEngine on
    # RewriteCond ${HTTP:Upgrade} websocket [NC]
    # RewriteCond ${HTTP:Connection} upgrade [NC]

    SSLEngine on

    SSLCertificateFile "certificates/live/${ST_LAB_DOMAIN}/fullchain.pem"
    SSLCertificateKeyFile "certificates/live/${ST_LAB_DOMAIN}/privkey.pem"

    Protocols h2 http/1.1

    Header always set Strict-Transport-Security "max-age=63072000"

    ProxyPass / http://minio01:9001/
    ProxyPassReverse / http://minio01:9001/

    RemoteIPHeader X-Forwarded-For

</VirtualHost>
