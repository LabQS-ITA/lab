#!/usr/bin/env bash
set -euo pipefail

function backup_container {

    docker export $c | gzip -9 > bkp_$1_$(date +%F-%H%M).docker.tar.gz

}

function backup_postgres() {

    docker exec -i $1 /usr/bin/pg_dumpall -U postgres -w | gzip -9 > bkp_$1_$(date +%F-%H%M).sql.gz

}

function backup_mariadb() {

    docker exec -i $1 /usr/bin/mysqldump -u root -A | gzip -9 > bkp_$1_$(date +%F-%H%M).sql.gz

}

function backup_mongodb() {

    docker exec -i $1 /usr/bin/mongodump  --config=/etc/mongo/.mdbpass - | gzip -9 > bkp_$1_$(date +%F-%H%M).bson.gz

}

# for c in $(docker ps -a --format '{{.Names}}');
# do
#     backup_container $c
# done

# backup_postgres postgres
# backup_postgres postgres01
# backup_postgres postgres02

# backup_mariadb mariadb01
# backup_mariadb mariadb02

backup_mongodb mongodb
